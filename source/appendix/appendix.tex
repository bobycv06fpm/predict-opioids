\documentclass[11pt, letter]{article}
\usepackage[left=0.5in, right=0.5in, top=0.5in, bottom=0.75in]{geometry}
\usepackage{graphicx}

% Helvetica font
\usepackage[scaled]{helvet}
\renewcommand\familydefault{\sfdefault} 
\usepackage[T1]{fontenc}
\usepackage{textcomp}

% Hyperlinks
\usepackage{hyperref}
\hypersetup{
    bookmarks=true,
    urlcolor=blue,
    colorlinks=true
}

% Endnotes
\usepackage{endnotes}
\renewcommand{\makeenmark}{\textsuperscript{\theenmark}}
\makeatletter
\def\enoteformat{\textsuperscript{\theenmark}}
\makeatother

% Paragraphs
\usepackage[parfill]{parskip}

% Import references
\input{source/appendix/references}

\begin{document}

\begin{center}
\huge Appendix
\end{center}

\section{Experimental Design}

Our objective was to define a panel of Rhode Island Medicaid recipients who received an initial opioid prescription under Medicaid coverage; define adverse outcomes of opioid dependence, abuse, or poisoning; and model and assess the accuracy of predictions of adverse outcomes using information known only prior to the initial prescription. Data were split into randomly-sampled training, validation, and testing sets using the ratio 50:25:25 at the beginning of the study. We report the results of model predictions on the testing set, which was withheld from analysis prior to the preparation of the manuscript.

Data are from the period 2001-2017, and include Rhode Island administrative records from the Department of Human Services (DHS), Department of Labor and Training (DLT), Department of Corrections (DOC), Medicaid program (under the Executive Office of Health and Human Services), and police agencies (including the Rhode Island State Police and eight municipal police departments).

Although our data span the years 2001 to 2017, we construct a panel of individuals with initial prescriptions between 2006 and 2012 to allow for the construction of features up to five years before the initial prescription and to define outcomes up to five years after the initial prescription.

\section{Panel and Outcome Definitions}

\subsection{Opioid Prescriptions}

To define our panel, we first establish which pharmacy claims correspond to opioid prescriptions. The primary identifier for the dispensed drug is a standardized 11-digit National Drug Code (NDC) from the U.S. Food and Drug Administration's NDC Directory.\endnote{\refndc} This directory is only available as a current snapshot, and because our claims data start in 2001, there are many unmapped NDCs to the current directory. Out of approximately 14.8 million pharmacy claims between 2006 and 2012, only 66.8 percent join to the current directory. Therefore, we construct a historical NDC directory using a data mining framework that downloads and collates all available Internet Archive snapshots of the FDA's NDC website since 2000.\endnote{\refhistoricalndc} This historical directory also includes full ingredient lists for each NDC, standardized to milligrams. Using this improved directory, 88.1 percent of pharmacy claims between 2006 and 2012 map to an NDC entry. 

We define an opioid prescription as any claim for a drug containing an opioid ingredient at or above the recommended starting dose when initiating opioid therapy for chronic pain management, as established in Washington State's 2015 prescribing guideline and further cited in the Centers for Disease Control's 2016 prescribing guideline.\endnote{\refamdg}\textsuperscript{,}\endnote{\refdowell} Exhibit A1 lists these ingredients and the minimum amounts we use to define an opioid drug. Of the 4,359 drugs containing one of these ingredients, 4,175 meet the minimum threshold amount and appear in 3.9 percent of claims.

Additionally, we define a recovery prescription as any NDC containing one of four ingredients commonly used in medication-assisted treatment of an opioid use disorder, which identifies 412 such drugs that appear in 0.5 percent of claims. These prescriptions may indicate that an individual has a preexisting opioid use disorder.

\subsection{Outcomes}

For each individual in our panel, we examine all of the Medicaid claims following their initial opioid prescription to construct indicator variables for four types of adverse outcomes: opioid dependence, opioid abuse, prescription-opioid poisoning and heroin poisoning. We include heroin poisoning as an outcome given the increasing use of heroin among those who abuse opioids, and the high proportion (greater than 80 percent) of joint heroin-prescription-opioid users who abused opioids prior to using heroin.\endnote{\refjones}

We determine these outcomes from the claim's International Classification of Diseases (ICD) diagnosis codes, which are used by medical professionals to classify a patient's health conditions following an encounter. Because our data span the transition from the ICD-9 to ICD-10 classification, we include diagnosis codes from both. Exhibit A2 lists the exact codes used to indicate each of these four diagnosis-related outcomes. 

Not everyone with an opioid use disorder receives a diagnosis code. Though it is unknown precisely what fraction of opioid use disorders go undiagnosed, Carrell {\em et al}. found that diagnosis codes were missing for as many as a quarter of patients for whom their providers were aware of opioid abuse.\endnote{\refcarrell} Similarly, a study by Barocas {\em et al}. estimated that only 44\% of individuals with opioid use disorder were identified as such in claims and administrative records.\endnote{\refbarocas} To address the challenges with diagnoses codes, we define a fifth treatment outcome using procedure codes related to the treatment of opioid use disorder, and more generally for drug rehabilitation and detoxification (Exhibit A2). Finally, we define a sixth ``any" outcome as the union of any of the diagnoses or treatment outcomes, to capture as broad a population of individual with opioid use disorder as possible. Data and measurement limitations notwithstanding, our model demonstrates that administrative data can be combined to form an accurate prediction of these outcomes, suggesting a feasible path forward for utilizing data to inform prescription risk. Exhibit A3 shows the accumulating fraction of adverse outcomes over the five year period following initial prescription.

\subsection{Final Panel}

Out of 400,024 distinct Medicaid enrollees between 2006 and 2012, our panel initially contains 74,213 individuals who received at least one opioid prescription in that period. We exclude 511 individuals who received a recovery prescription before their initial opioid prescription, since this indicates they may have been seeking treatment for an opioid use disorder. We exclude 3,549 individuals with an adverse outcome prior to their initial opioid prescription, since we assume they were already receiving opioids from another source, such as through private insurance before enrolling in Medicaid. Our final panel includes 70,153 individuals. Exhibit A4 shows the incidence of adverse outcomes among these individuals by baseline characteristics.

\section{Feature Engineering}

\subsection{Summary Features}

We construct features that summarize information known in the 12 months prior to the individual's initial prescription.

Using the demographics from the integrated RI 360 database\endnote{\refhastings}, we construct features for (modal) age, sex, race, marital status, body mass index, and median income and fraction below the federal povery line in the home Census block group. Using DHS data, we construct features for household size and new births in the household, and monthly payments for the Supplemental Nutrition Assistance Program (SNAP), the Temporary Assistance for Needy Families (TANF), the General Public Assistance (GPA), the Child Care Assistance Program (CCAP), and State Supplemental Payment portions of Supplemental Security Income benefits. Using DLT data, we construct indicators for sector of work derived from the first two digits of industry codes assigned according to the North American Industry Classification System (NAICS); monthly payments for Temporary Disability Insurance (TDI) and Unemployment Insurance (UI); and quarterly wage history, including average quarterly wages and variance, the number of employers and the number of hours worked (for hourly employees); the monthly unemployment rate in Rhode Island; and the annual national unemployment rate for two-digit NAICS industries that the individual has worked in. Using DOC data, we construct indicators for charges, seven categories of sentencing, and commitments and releases from prison. Using police data, we construct features for arrests; the number of car crashes involved and injured in; and the number of and total fines for citations.

The largest set of features comes from the Medicaid data. These include indicators for enrollment eligibility categories, plan type, and payer codes; number of claims and total bill and payment amounts for all claims and for Emergency Department claims; indicators for prescriptions in 261 drug categories from the AHFS Pharmacologic/Therapeutic Classification;\endnote{\refashp} and topic models summarizing the concatenated text descriptions for all of the individual's ICD-9 diagnosis codes and HCPCS procedure codes.

Within the prescription drug categories, there is a category for opiate agonists. By construction of our panel, no individuals should have previously received an opioid prescription. However, the opiate agonist category includes 152 drugs that were not identified in the 4,175 opioid drugs from our historical NDC directory, and which are listed in Exhibit A5. These drugs either contain an opioid ingredient at a lower amount than the minimum thresholds defined by the Washington State prescribing guidelines, or contain an ingredient not identified in those guidelines (e.g., ``opium''). Therefore, the opiate agonist feature indicates that the individual received a drug that was not likely for initiating opioid therapy, but nonetheless contains a small amount of an opioid ingredient. Most of these drugs are over-the-counter cough syrups or painkillers combined with small amounts of an opioid ingredient. Of the 152, there are eight that are not present in the historical NDC directory, possibly because they were on the market for a short enough time that they do not occur in any of the available historical snapshots of the NDC directory.

We construct the topic models using a technique called non-negative matrix factorization, which is commonly used in text analysis to discover latent topic structure in documents. In this application, we treat each individual's concatenated text descriptions of diagnosis and procedure codes as a document to learn the latent topic structure across individuals' health histories. Our topic models are trained on 70,153 documents comprised of distinct words from the code descriptions, after removing uninformative words using a stopword list.

Because the number of latent topics is not known \emph{a priori}, we tune this parameter based on 

This tuning achieves AUCs of 0.660 for 10 topics, 0.674 for 20 topics, 0.703 for 50 topics, 0.714 for 100 topics, 0.716 for 200 topics, and 0.696 for 500 topics. Therefore, we select the model with 200 topics as the final features.

It involves factorizing a d x w matrix into a d x t matrix and a t x w matrix such that all three matrices have only non-negative entries, where 

When used in text analysis, it involves factorising a matrix containing the number of observations of word w_i in document d_j into a matrix containing the propensity of word w_i to appear in topic t_k and a matrix showing the likelihood that document d_j is assigned to topic t_k.

There are two key reasons why this is useful to our model. The first is dimensionality reduction: as t can be much lower than w, using the d x t matrix instead of the d x w matrix can greatly decrease the dimensionality of our feature space. The second is information extraction. Combining many words into a single feature means that feature may have a stronger signal than the individual words would have had by themselves. 

Before constructing the word frequency, we remove a list of stopwords that 

We summarize each top using the 10 words with the greatest frequency within  ...

\subsection{Tensor Features}

We construct tensors of monthly values for a given feature for each of the individuals in our panel in the 12 months prior to the individual's initial prescription. Missing values are imputed using mean values from the training population.

The DHS tensor includes 13 features for demographics (age and indicators for sex, race, and Spanish or Portuguese as a primary language) and monthly payments for the Supplemental Nutrition Assistance Program (SNAP), the Temporary Assistance for Needy Families (TANF), the General Public Assistance (GPA), the Child Care Assistance Program (CCAP), and State Supplemental Payment portions of Supplemental Security Income benefits.

The DLT tensor includes 31 features for indicators for sector of work derived from the first two digits of industry codes assigned according to the North American Industry Classification System (NAICS); monthly payments for Temporary Disability Insurance (TDI) and Unemployment Insurance (UI); and quarterly wage history, including wage amount, the number of employers and the number of hours worked (for hourly employees).

The DOC tensor includes 16 features for demographics (age and indicators for sex, race, Spanish as a primary language), and indicators for charges, seven categories of sentencing, and commitments and releases from prison.

The Medicaid tensor includes 683 features for demographics (age and indicators for sex, race, and Spanish or Portuguese as a primary language); indicators for eligibility categories, plan type, and payer codes at each month of enrollment; number of claims and total bill and payment amounts for all claims and for Emergency Department claims; the number of prescriptions in each of the 141 second-level categories from the AHFS Pharmacologic/Therapeutic Classification;\endnote{\refashp} and indicators for ICD-9 diagnosis codes and HCPCS procedure codes for all codes that are correlated >0.02 with any adverse outcome in the training population.

The police tensor includes 42 features for demographics (age and indicators for sex and officer-observed race); indicators for all arrests, DUI arrests, and domestic-offense arrests; the number of car crashes involved and injured in; the number of and total fines for citations; and the spatio-temporal intensity of calls for service in the individual's home Census block group for 29 categories of calls.

Finally, we construct an integrated tensor including all of the 785 features from the DHS, DLT, DOC, Medicaid, and police tensors. The dimension of this integrated tensor are 70,153 individuals x 12 months x 785 features.

\section{Models}

\subsection{Linear}

Exhibit A6 lists the summary features selected by the BOLASSO. Exhibit A7 provides the full regression output of the BOLASSO Logit model.

\subsection{Neural Networks}

To obtain predictions of adverse outcomes after the initial prescription, we train a neural network model for each tensor using the Python package Keras (https://keras.io), which provides an interface to the TensorFlow\endnote{\refabadi} library. We specifically choose to train a recurrent neural network (RNN), since RNNs have the ability to model temporal patterns in the input data. We input our training data into a two-layer network of 10x10 Long Short-Term Memory (LSTM)\endnote{\refhochreiter} units and use the tanh activation function. We input the last LSTM layer into a dense layer that applies a sigmoid activation function to the weighted sum of the 16 inputs in order to produce a single predicted probability of adverse outcome. We employ regularization prior to each layer in the form of a dropout factor of 0.25, which causes a random deactivation of units within the layer during training with a fixed probability of 0.25.\endnote{\refsrivastava}

The neural networks are optimized to minimize the binary cross-entropy, also known as log-loss, on the training data. We use the Adam\endnote{\refkingma} optimization algorithm, training with a batch size of 16. We tune the model on a hold-out validation set by allowing the neural network to train for as many epochs as needed until the area under the receiver-operator curve (AUC) from predictions on the validation set does not improve by 0.001. In Exhibit A8, we report the AUC from predictions on the testing set for each data source and each individual outcome.

\theendnotes

\newpage

\textbf{Exhibit A1.} Minimum amounts of ingredients in a drug to classify it as an opioid prescription or a recovery prescription.

\begin{tabular}{lc}
\em Opioid Ingredient & \em Minimum Amount (mg) \\[0.5em]
Codeine & 30.0 \\
Fentanyl & 0.0125 \\
Hydrocodone & 5.0 \\
Hydromorphone & 2.0 \\
Meperidine* & 0.0 \\
Morphine & 10.0 \\
Oxycodone & 5.0 \\
Oxymorphone & 5.0 \\
Tapentadol & 50.0 \\
Tramadol & 50.0 \\[1em]
\em Recovery Ingredient° & \em Minimum Amount (mg) \\[0.5em]
Buprenorphine & 0.0 \\
Methadone & 0.0 \\
Naloxone & 0.0 \\
Naltrexone & 0.0 \\[1em]
\end{tabular}

\hrule

\footnotesize
* Meperidine has no recommended starting dose for treatment of chronic pain because of its risk for complications in older adults; therefore, we consider any amount as evidence that the drug is an opioid. \\
° We consider any amount of a recovery ingredient as evidence that the drug may have been used to treat a prior opioid use disorder.
\normalsize

\newpage

\textbf{Exhibit A2.} Diagnosis and procedure codes used to indicate adverse outcomes when occurring in any claim after the initial opioid prescription.

\begin{tabular}{lll}
\em Outcome & \em Code & \em Description \\[1em]
\textbf{Opioid} & 304.0 & Opioid type dependence \\
\textbf{Dependence} & 304.7 & Combinations of opioid type drug with any other drug dependence \\
 & F11.2* & Opioid dependence \\[1em]
\textbf{Opioid Abuse} & 305.0 & Nondependent opioid abuse  \\
 & F11.1* & Opioid abuse \\[1em]
\textbf{Prescription-} & 965.00 & Poisoning by opium (alkaloids), unspecified \\
\textbf{Opioid} & 965.02 & Poisoning by methadone \\
\textbf{Poisoning} & 965.09 & Poisoning by other opiates and related narcotics \\
 & 970.1 & Poisoning by opiate antagonists \\
 & E850.1 & Accidental poisoning by methadone \\
 & E850.2 & Accidental poisoning by other opiates and related narcotics \\
 & E935.1 & Methadone causing adverse effects in therapeutic use \\
 & E935.2 & Other opiates and related narcotics causing adverse effects in therapeutic use \\
 & E940.1 & Opiate antagonists causing adverse effects in therapeutic use \\
 & T400* & Poisoning by, adverse effect of and underdosing of opium \\
 & T402* & Poisoning by, adverse effect of and underdosing of other opioids \\
 & T403* & Poisoning by, adverse effect of and underdosing of methadone \\[1em]
\textbf{Heroin} & 965.01 & Poisoning by heroin \\
\textbf{Poisoning} & E850.0 & Accidental poisoning by heroin \\
 & E935.0 & Heroin causing adverse effects in therapeutic use \\
 & T401* & Poisoning by and adverse effects of heroin \\[1em]
\textbf{Treatment} & J2310° & Naloxone HCI Injection, per 1 mg \\
 & J2315° & Naltrexone injection, depot form, 1mg \\
 & J0592° & Buprenorphine HCL injection, 0.1mg \\
 & X0305° & Methadone detoxification – outpatient \\
 & X0321° & Methadone maintenance, assessment and evaluation, counseling, treatment \\
 &  & and review, and lab testing \\
 & H0020° & Alcohol and or drug services; methadone administration and or service \\
 & J1230° & Injection, methadone, up to 10mg \\
 & 83840° & methadone \\
 & 946° & Alcohol and drug rehabilitation and counseling \\
 & 9464° & drug rehabilitation \\
 & 9465° & drug detoxification \\
 & 9466° & drug rehabilitation and detoxification \\
 & 9467° & combined alcohol and drug rehabilitation \\
 & 9468° & combined alcohol and drug detoxification \\
 & 9469° & combined alcohol and drug rehabilitation and detoxification \\[1em]
\end{tabular}

\hrule

\footnotesize
* ICD-10 diagnosis code \\
° HCPCS procedure code
\normalsize

\newpage

\textbf{Exhibit A3.} Cumulative frequency of adverse outcomes over time since initial opioid prescription. Adverse outcomes are indicated by the diagnosis and procedure codes in Medicaid claims following the initial prescription. An individual may experience multiple types of adverse outcomes, and ``any" is the union of the five specific outcome types. Opioid dependence is the most prevalent of the types.

\includegraphics[width=6in]{output/figures/FigureA3}

\newpage

\textbf{Exhibit A4.} Descriptive statistics for the final panel.

\input{output/tables/TableA4}

\newpage

\textbf{Exhibit A5.} Low-dosage prescription opioids identified by the ASHP category for opiate agonists.

\tiny
\input{output/tables/TableA5}

* NDC code exists in ASHP categoriation but does not exist in NDC Directory
\normalsize

\newpage

\textbf{Exhibit A6.} Features selected by BOLASSO as occurring in more than 90\% of LASSO replicates.

\tiny
\input{output/tables/TableA6}
\normalsize

\newpage

\textbf{Exhibit A7.} Regression output for the BOLASSO Logit model.

\tiny
\input{output/tables/TableA7}
\normalsize

\newpage

\textbf{Exhibit A8.} Area Under the Receiver-Operating Characteristic Curve (AUC) of neural network models using different subsets of administrative data and outcome definitions. Confidence intervals are calculated from 100 bootstrap replicates.

\scriptsize
\input{output/tables/TableA8}
\normalsize

\newpage

\end{document}
